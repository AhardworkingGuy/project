{"version":3,"file":"activity.js","sources":["store/activity.js"],"sourcesContent":["import { defineStore } from 'pinia'\r\n\r\n// 模拟 API\r\nfunction getActivities() {\r\n  return new Promise(resolve => {\r\n    setTimeout(() => {\r\n      resolve([\r\n        {\r\n          id: 1,\r\n          title: '校园歌唱大赛',\r\n          time: '2025-09-05 18:00',\r\n          location: '礼堂',\r\n          remaining: 30,\r\n          description: '展示你的歌喉',\r\n          signedUp: false\r\n        },\r\n        {\r\n          id: 2,\r\n          title: '篮球比赛',\r\n          time: '2025-09-10 15:00',\r\n          location: '体育馆',\r\n          remaining: 20,\r\n          description: '快来一起打球吧！',\r\n          signedUp: false\r\n        }\r\n      ])\r\n    }, 300)\r\n  })\r\n}\r\n\r\nexport const useActivityStore = defineStore('activity', {\r\n  state: () => ({\r\n    activities: [],\r\n    signUpLogs: []\r\n  }),\r\n  actions: {\r\n    async fetchActivities() {\r\n      const cache = uni.getStorageSync('activities')\r\n      if (cache) {\r\n        this.activities = cache\r\n      } else {\r\n        const data = await getActivities()\r\n        this.activities = data\r\n        uni.setStorageSync('activities', data)\r\n      }\r\n    },\r\n    getActivityById(id) {\r\n      return this.activities.find(a => a.id == id) || {}\r\n    },\r\n    signUp(id, form) {\r\n      const activity = this.activities.find(a => a.id == id)\r\n      if (activity && !activity.signedUp) {\r\n        activity.signedUp = true\r\n        activity.remaining -= 1\r\n        uni.setStorageSync('activities', this.activities)\r\n\r\n        const signUpTime = new Date().toLocaleString()\r\n        this.signUpLogs.push({\r\n          activityId: id,\r\n          activityTitle: activity.title,\r\n          signUpTime: signUpTime,\r\n          name: form.name,\r\n          studentId: form.studentId,\r\n          phone: form.phone\r\n        })\r\n        uni.setStorageSync('signUpLogs', this.signUpLogs)\r\n\r\n        console.log(`[报名表提交日志] 活动ID: ${id}, 活动名称: ${activity.title}, 提交时间: ${signUpTime}, 姓名: ${form.name}, 学号: ${form.studentId}, 手机号: ${form.phone}`)\r\n      } else {\r\n        console.log(`[报名表提交日志] 活动ID: ${id}, 活动名称: ${activity.title}, 提交时间: ${signUpTime}, 报名失败: 已经报名或名额已满`)\r\n      }\r\n    }\r\n  }\r\n})\r\n"],"names":["defineStore","uni","signUpTime"],"mappings":";;AAGA,SAAS,gBAAgB;AACvB,SAAO,IAAI,QAAQ,aAAW;AAC5B,eAAW,MAAM;AACf,cAAQ;AAAA,QACN;AAAA,UACE,IAAI;AAAA,UACJ,OAAO;AAAA,UACP,MAAM;AAAA,UACN,UAAU;AAAA,UACV,WAAW;AAAA,UACX,aAAa;AAAA,UACb,UAAU;AAAA,QACX;AAAA,QACD;AAAA,UACE,IAAI;AAAA,UACJ,OAAO;AAAA,UACP,MAAM;AAAA,UACN,UAAU;AAAA,UACV,WAAW;AAAA,UACX,aAAa;AAAA,UACb,UAAU;AAAA,QACX;AAAA,MACT,CAAO;AAAA,IACF,GAAE,GAAG;AAAA,EACV,CAAG;AACH;AAEY,MAAC,mBAAmBA,cAAW,YAAC,YAAY;AAAA,EACtD,OAAO,OAAO;AAAA,IACZ,YAAY,CAAE;AAAA,IACd,YAAY,CAAE;AAAA,EAClB;AAAA,EACE,SAAS;AAAA,IACP,MAAM,kBAAkB;AACtB,YAAM,QAAQC,cAAAA,MAAI,eAAe,YAAY;AAC7C,UAAI,OAAO;AACT,aAAK,aAAa;AAAA,MAC1B,OAAa;AACL,cAAM,OAAO,MAAM,cAAe;AAClC,aAAK,aAAa;AAClBA,4BAAI,eAAe,cAAc,IAAI;AAAA,MACtC;AAAA,IACF;AAAA,IACD,gBAAgB,IAAI;AAClB,aAAO,KAAK,WAAW,KAAK,OAAK,EAAE,MAAM,EAAE,KAAK,CAAE;AAAA,IACnD;AAAA,IACD,OAAO,IAAI,MAAM;AACf,YAAM,WAAW,KAAK,WAAW,KAAK,OAAK,EAAE,MAAM,EAAE;AACrD,UAAI,YAAY,CAAC,SAAS,UAAU;AAClC,iBAAS,WAAW;AACpB,iBAAS,aAAa;AACtBA,sBAAAA,MAAI,eAAe,cAAc,KAAK,UAAU;AAEhD,cAAMC,eAAa,oBAAI,KAAM,GAAC,eAAgB;AAC9C,aAAK,WAAW,KAAK;AAAA,UACnB,YAAY;AAAA,UACZ,eAAe,SAAS;AAAA,UACxB,YAAYA;AAAA,UACZ,MAAM,KAAK;AAAA,UACX,WAAW,KAAK;AAAA,UAChB,OAAO,KAAK;AAAA,QACtB,CAAS;AACDD,sBAAAA,MAAI,eAAe,cAAc,KAAK,UAAU;AAEhDA,4BAAA,MAAA,OAAA,2BAAY,mBAAmB,EAAE,WAAW,SAAS,KAAK,WAAWC,WAAU,SAAS,KAAK,IAAI,SAAS,KAAK,SAAS,UAAU,KAAK,KAAK,EAAE;AAAA,MACtJ,OAAa;AACLD,sBAAAA,8CAAY,mBAAmB,EAAE,WAAW,SAAS,KAAK,WAAW,UAAU,mBAAmB;AAAA,MACnG;AAAA,IACF;AAAA,EACF;AACH,CAAC;;"}